sap.ui.controller("view.login", {

    onInit: function() {
    },

    onKeypress: function(oEvent) {
        if (oEvent.keyCode === 13) {
            this.onLogin();
        }
    },

    onLogin: function(oEvent) {
    	if (alsApp.config.email === 'demo') {
    		alsApp.config.isDemoMode = true;
            localStorage.setItem('alsFirstName', 'Demo');
            alsApp.goToPage("weeklyTasksPage");
            alsApp.getPage('weeklyTasksPage').replaceHeader();
            return;
    	}
    	
        if (alsApp.config.email !== "" && alsApp.config.email !== null) {
            alsApp.busyDialog.open();

            $.ajax({
                type: 'POST',
                url: alsApp.config.SERVER_URL + '/../j_spring_security_check?j_username=' + alsApp.config.email + '&j_password=' + this.getView().passwordInput.getValue(),
                contentType: 'application/json',
                success: function(result) {
                    var result = JSON.parse(result);
                    localStorage.setItem('alsFirstName', result[0].firstName);
                    
                    alsApp.goToPage("weeklyTasksPage");
                    alsApp.getPage('weeklyTasksPage').replaceHeader();
                },
                error: function() {
                    sap.m.MessageBox.alert('Your email or password were not identified', {
                        title: 'Login failed'
                    });
                },
                complete: function() {
                    alsApp.busyDialog.close();
                }
            });
        }
        else {
            sap.m.MessageBox.alert('Please fill in your email before logging in', {
                title: 'Details Missing'
            });
        }
    },

    onRegister: function(oEvent) {
        alsApp.goToPage("registerPage");
    },

    onForgotPassword: function(oEvent) {
    	sap.m.MessageBox.alert('This feature will be available soon', {
            title: 'Coming soon'
        });
    },

    onDisclaimer: function(oEvent) {
        sap.m.MessageBox.alert('This software application ("App"), including the coding and/or code lines/ strings ("Code") serves only as an example for initial evaluation, and are not intended to be used either for commercialization, or in a productive system environment. The App and Code are only intended for evaluation, creating statistics, and for visualization. Prize4Life does not warrant the correctness and/or completeness of either the App, or the Code or any results generated by using either, and Prize4Life shall not be liable for errors or damages caused by the usage of the App and/or Code, except if such damages were caused by Prize4Life being intentionally or grossly negligent while the App and Code being used solely for the purpose of initial evaluation.', {
            title: 'Legal Disclaimer',
            styleClass: 'legalDisclaimer'
        });
    }

});
